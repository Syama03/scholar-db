<!DOCTYPE html>
<html>
<head>
  <title>論文管理-論文情報編集</title>
  <link rel="stylesheet" href="/style.css" />
</head>

<body>

  <div id="header"></div>
  <script>
  fetch('/header.html')
    .then(response => response.text())
    .then(data => document.getElementById('header').innerHTML = data);
  </script>

  <h1>論文を編集</h1>
    <form method="POST" action="/edit/<%= id %>" enctype="multipart/form-data">
      <input name="title" value="<%= paper.title %>" required /><br />
      <textarea name="summary" required><%= paper.summary %></textarea><br />
      <input name="link" value="<%= paper.link %>" /><br />
      <label>PDFファイル:</label>
        <input type="file" name="pdfFile" accept="application/pdf" /><br />

      <label>既存タグ（複数選択可）:</label><br />
      <select name="tags" id="tagsSelect" multiple size="5">
        <% 
          let paperTags = [];
          try { paperTags = JSON.parse(paper.tags || '[]'); } catch(e) { paperTags = paper.tags ? paper.tags.split(',').map(s=>s.trim()) : []; }
        %>
        <% tags.forEach(t => { %>
          <option value="<%= t %>" <%= paperTags.includes(t) ? 'selected' : '' %>><%= t %></option>
        <% }) %>
      </select>
      <br />
      <label>新しいタグ（カンマ区切り）:</label>
      <input type="text" name="newTags" placeholder="例: IDS, セキュリティ" />
      <br />

      <button type="submit">保存</button>
    </form>

    <!-- タグは上のセレクトと新規タグ入力で扱います -->

<div id="footer"></div>
<script>
fetch('/footer.html')
  .then(response => response.text())
  .then(data => document.getElementById('footer').innerHTML = data);
</script>

</body>
</html>
