<!DOCTYPE html>
<html>
<head>
  <title>論文管理-論文情報編集</title>
  <link rel="stylesheet" href="/style.css" />
</head>

<body>

  <div id="header"></div>
  <script>
  fetch('/header.html')
    .then(response => response.text())
    .then(data => document.getElementById('header').innerHTML = data);
  </script>

  <h1>論文を編集</h1>
    <form method="POST" action="/edit/<%= id %>">
      <input name="title" value="<%= paper.title %>" required /><br />
      <textarea name="summary" required><%= paper.summary %></textarea><br />
      <input name="link" value="<%= paper.link %>" /><br />
      <input name="pdfPath" value="<%= paper.pdfPath %>" /><br />

      <input type="text" name="newCategory" placeholder="新しいカテゴリを入力" />
      <label>カテゴリ:</label>
      <select id="categorySelect" name="category">
        <% categories.forEach(cat => { %>
          <option value="<%= cat %>" <%= paper.category === cat ? "selected" : "" %>><%= cat %></option>
        <% }) %>
      </select><br />

      <input type="text" name="newSubCategory" placeholder="新しいサブカテゴリを入力" />
      <label>サブカテゴリ:</label>
      <select id="subcategorySelect" name="subcategory"></select>
      <br />

      <button type="submit">保存</button>
    </form>

    <script>
      const categorySelect = document.getElementById("categorySelect");
      const subcategorySelect = document.getElementById("subcategorySelect");

      async function updateSubcategories() {
        const selectedCategory = categorySelect.value;
        if (!selectedCategory) return;

        try {
          const response = await fetch(`/subcategories/${encodeURIComponent(selectedCategory)}`);
          const subs = await response.json();

          subcategorySelect.innerHTML = "";
          subs.forEach(sub => {
            const option = document.createElement("option");
            option.value = sub;
            option.textContent = sub;
            subcategorySelect.appendChild(option);
          });
        } catch (err) {
          console.error("サブカテゴリ取得エラー:", err);
        }
      }

      // 初期表示 & カテゴリ変更時に更新
      categorySelect.addEventListener("change", updateSubcategories);
      updateSubcategories();
    </script>

<div id="footer"></div>
<script>
fetch('/footer.html')
  .then(response => response.text())
  .then(data => document.getElementById('footer').innerHTML = data);
</script>

</body>
</html>
