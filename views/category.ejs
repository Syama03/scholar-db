<!DOCTYPE html>
<html>
<head>
  <title>論文管理-<%= category %></title>
  <link rel="stylesheet" href="/style.css" />
</head>

<h2><%= category %> の論文一覧</h2>
<p><a href="/">トップページへ戻る</a></p>

<div class="subcategory-container">
  <% Object.keys(grouped).forEach(sub => { %>
    <details class="subcategory-card">
      <summary>
        <span class="subcategory-title"><%= sub %></span>
        <span class="count">（<%= grouped[sub].length %>件）</span>
      </summary>
      <ul class="paper-list">
        <% grouped[sub].forEach(paper => { %>
          <li class="paper-card">
            <div class="paper-info">
              <h4>
                <%= paper.title %>
                <span class="star <%= paper.important ? 'active' : '' %>" 
                      onclick="toggleStar(this)">
                  <%= paper.important ? '★' : '☆' %>
                </span>
              </h4>
              <p><%= paper.summary %></p>

              <div class="links">
                <% if (paper.link) { %>
                  <a href="<%= paper.link %>" target="_blank">外部リンク</a>
                <% } %>
                <% if (paper.pdfPath) { %>
                  <a href="/pdfs/<%= paper.pdfPath %>" target="_blank">PDF</a>
                <% } %>
                  <a href="/edit/<%= papers.indexOf(paper) %>" class="edit-link">編集</a>
              </div>
            </div>
          </li>
        <% }) %>
      </ul>
    </details>
  <% }) %>
</div>

<script>
  function toggleStar(el) {
    if (el.classList.contains("active")) {
      el.classList.remove("active");
      el.textContent = "☆";
    } else {
      el.classList.add("active");
      el.textContent = "★";
    }

    // TODO: サーバーに状態を保存する処理を追加
    // 例: fetch('/toggle-important', { method:'POST', body: JSON.stringify({ id: paperId }) })
  }
</script>