<!DOCTYPE html>
<html>
<head>
  <title>論文管理-タグ: <%= tag %></title>
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
<div id="header"></div>

<script>
fetch('/header.html')
  .then(response => response.text())
  .then(data => document.getElementById('header').innerHTML = data);
</script>

<h2>タグ: <%= tag %> （<%= papers.length %> 件）</h2>

<ul class="paper-list">
  <% papers.forEach(paper => { %>
    <li class="paper-card">
      <div class="paper-info">
        <h4>
          <%= paper.title %>
          <span class="star <%= paper.importance ? 'active' : '' %>" onclick="toggleStar('<%= paper.id %>' , this)">
            <%= paper.importance ? '★' : '☆' %>
          </span>
        </h4>
        <p><%= paper.summary %></p>

        <div class="links">
          <% if (paper.link) { %>
            <a href="<%= paper.link %>" target="_blank">外部リンク</a>
          <% } %>
          <% if (paper.pdf_path) { %>
            <a href="/pdfs/<%= paper.pdf_path %>" target="_blank">PDF</a>
          <% } %>
            <a href="/edit/<%= paper.id %>" class="edit-link">編集</a>
        </div>
      </div>
    </li>
  <% }) %>
</ul>

<div id="footer"></div>
<script>
fetch('/footer.html')
  .then(response => response.text())
  .then(data => document.getElementById('footer').innerHTML = data);
</script>

</body>

<script>
async function toggleStar(paperId, el) {
  const isActive = el.classList.contains("active");
  el.classList.toggle("active");
  el.textContent = isActive ? "☆" : "★";

  await fetch(`/papers/${paperId}/toggle-important`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ important: !isActive })
  });
}
</script>
